# <diamond> feedback http://www.aps.anl.gov/epics/tech-talk/2010/msg00131.php
# FOO   : setpoint
# FOO:r : readback
# FOO:s : sync
# FOO:w : write


record(bo, "$(HOST):$(USER):$(UUT):REFRESH") {
	field(DTYP, "Soft Channel")
	field(FLNK, "$(HOST):$(USER):$(UUT):REFRESH:w PP")
	field(ZNAM, "0")
	field(ONAM, "1")
}


record(bo, "$(HOST):$(USER):$(UUT):REFRESH:w") {
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(HOST):$(USER):$(UUT),0,$(TIMEOUT))REFRESH")
	field(DISV, "1")
	field(SDIS, "$(HOST):$(USER):$(UUT):REFRESH:s")
	field(ZNAM, "0")
	field(ONAM, "1")

}

record(bi, "$(HOST):$(USER):$(UUT):REFRESH:r") {
	field(DTYP, "asynInt32")
	field(INP,  "@asyn($(HOST):$(USER):$(UUT),0,$(TIMEOUT))REFRESHr")
	field(SCAN, "I/O Intr")
	field(FLNK, "$(HOST):$(USER):$(UUT):REFRESH:s")
	field(ZNAM, "0")
	field(ONAM, "1")
}

record(bo, "$(HOST):$(USER):$(UUT):REFRESH:s") {
	field(DTYP, "Soft Channel")
	field(OMSL, "closed_loop")
	field(DOL,  "$(HOST):$(USER):$(UUT):REFRESH:r NPP")
	field(OUT,  "$(HOST):$(USER):$(UUT):REFRESH PP")
	field(ZNAM, "0")
	field(ONAM, "1")
}


record(bo, "$(HOST):$(USER):$(UUT):MMAPUNMAP") {
	field(DTYP, "Soft Channel")
	field(OUT,  "$(HOST):$(USER):$(UUT):MMAPUNMAP:w PP")
	field(ZNAM, "UNMAP")
	field(ONAM, "MMAP")
}

record(bo, "$(HOST):$(USER):$(UUT):act") {
	field(DTYP, "Soft Channel")
	field(OMSL, "closed_loop")
	field(DOL,  "$(HOST):ONRUN:N NPP")
	field(OUT,  "$(HOST):$(USER):$(UUT):MMAPUNMAP PP")
}
record(fanout, "$(HOST):ONRUN:N:f") {
	field($(GFAN), "$(HOST):$(USER):$(UUT):act")

}

record(bo, "$(HOST):$(USER):$(UUT):MMAPUNMAP:w") {
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(HOST):$(USER):$(UUT),0,$(TIMEOUT))MMAPUNMAP")
	field(DISV, "1")
	field(SDIS, "$(HOST):$(USER):$(UUT):MAPUNMAP:s")
	field(ZNAM, "UNMAP")
	field(ONAM, "MMAP")
}

record(bi, "$(HOST):$(USER):$(UUT):MMAPUNMAP:r") {
	field(DTYP, "asynInt32")
	field(INP,  "@asyn($(HOST):$(USER):$(UUT),0,$(TIMEOUT))MMAPUNMAPr")
	field(SCAN, "I/O Intr")
	field(FLNK, "$(HOST):$(USER):$(UUT):MMAPUNMAP:s")
	field(ZNAM, "UNMAP")
	field(ONAM, "MMAP")
}

record(bo, "$(HOST):$(USER):$(UUT):MMAPUNMAP:s") {
	field(DTYP, "Soft Channel")
	field(OMSL, "closed_loop")
	field(DOL,  "$(HOST):$(USER):$(UUT):MMAPUNMAP:r NPP")
	field(OUT,  "$(HOST):$(USER):$(UUT):MMAPUNMAP PP")
	field(ZNAM, "0")
	field(ONAM, "1")
}

record(longin, "$(HOST):$(USER):$(UUT):NCHAN"){
	field(DTYP, "asynInt32")
	field(INP, "@asyn($(HOST):$(USER):$(UUT),0,$(TIMEOUT))NCHAN")
}

record(longin, "$(HOST):$(USER):$(UUT):NSAM"){
	field(DTYP, "asynInt32")
	field(INP, "@asyn($(HOST):$(USER):$(UUT),0,$(TIMEOUT))NSAM")
}

record(longout, "$(HOST):$(USER):$(UUT):STRIDE"){
	field(DTYP, "asynInt32")
	field(OUT, "@asyn($(HOST):$(USER):$(UUT),0,$(TIMEOUT))STRIDE")
	field(DRVL, "1")
	field(DRVH, "200")
	field(VAL,  "1")
	field(PINI, "YES")
}

record(ao, "$(HOST):$(USER):$(UUT):DELAY") {
	field(DTYP, "asynFloat64")
	field(OUT, "@asyn($(HOST):$(USER):$(UUT),0,$(TIMEOUT))DELAY")
	field(DRVL, "0")
	field(DRVH, "10")
	field(VAL,  "0")
	field(PINI, "YES")
}

record(ao, "$(HOST):$(USER):$(UUT):FS") {
	field(DTYP, "asynFloat64")
	field(OUT, "@asyn($(HOST):$(USER):$(UUT),0,$(TIMEOUT))FS")
	field(DRVL, "1e3")
	field(DRVH, "80e6")
	field(VAL,  "2e6")
	field(PINI, "YES")
}

# PAN_LEFT,  first USER then USER:UUT
record(bo, "$(HOST):$(USER):PAN_LEFT:1"){
	field(FLNK, "$(HOST):$(USER):PAN_LEFT:1:f")
}

record(fanout, "$(HOST):$(USER):PAN_LEFT:1:f") {
	field($(UFAN), "$(HOST):$(USER):$(UUT):PAN_LEFT:1 PP")
}

record(bo, "$(HOST):$(USER):$(UUT):PAN_LEFT:1") {
	field(FLNK, "$(HOST):$(USER):$(UUT):PAN_LEFT:1:c PP")
}

record(calcout, "$(HOST):$(USER):$(UUT):PAN_LEFT:1:c") {
	field(INPA, "$(HOST):$(USER):$(UUT):DELAY")
	field(CALC, "A-1")
	field(OOPT, "Every Time")
	field(DOPT, "Use CALC")
	field(OUT,  "$(HOST):$(USER):$(UUT):DELAY PP")
	field(FLNK, "$(HOST):$(USER):$(UUT):REFRESH PP")
}

# PAN_RIGHT,  first USER then USER:UUT
record(bo, "$(HOST):$(USER):PAN_RIGHT:1"){
	field(FLNK, "$(HOST):$(USER):PAN_RIGHT:1:f")
}

record(fanout, "$(HOST):$(USER):PAN_RIGHT:1:f") {
	field($(UFAN), "$(HOST):$(USER):$(UUT):PAN_RIGHT:1 PP")
}

record(bo, "$(HOST):$(USER):$(UUT):PAN_RIGHT:1") {
	field(FLNK, "$(HOST):$(USER):$(UUT):PAN_RIGHT:1:c PP")
}

record(calcout, "$(HOST):$(USER):$(UUT):PAN_RIGHT:1:c") {
	field(INPA, "$(HOST):$(USER):$(UUT):DELAY")
	field(CALC, "A+1")
	field(OOPT, "Every Time")
	field(DOPT, "Use CALC")
	field(OUT,  "$(HOST):$(USER):$(UUT):DELAY PP")
	field(FLNK, "$(HOST):$(USER):$(UUT):REFRESH PP")
}

# ZOOM:IN,  first USER then USER:UUT
record(bo, "$(HOST):$(USER):ZOOM:IN"){
	field(FLNK, "$(HOST):$(USER):ZOOM:IN:f")
}

record(fanout, "$(HOST):$(USER):ZOOM:IN:f") {
	field($(UFAN), "$(HOST):$(USER):$(UUT):ZOOM:IN PP")
}

record(bo, "$(HOST):$(USER):$(UUT):ZOOM:IN") {
	field(FLNK, "$(HOST):$(USER):$(UUT):ZOOM:IN:c PP")
}

record(calcout, "$(HOST):$(USER):$(UUT):ZOOM:IN:c") {
	field(INPA, "$(HOST):$(USER):$(UUT):STRIDE")
	field(CALC, "A/2")
	field(OOPT, "Every Time")
	field(DOPT, "Use CALC")
	field(OUT,  "$(HOST):$(USER):$(UUT):STRIDE PP")
	field(FLNK, "$(HOST):$(USER):$(UUT):REFRESH PP")
}

# ZOOM:OUT,  first USER then USER:UUT
record(bo, "$(HOST):$(USER):ZOOM:OUT"){
	field(FLNK, "$(HOST):$(USER):ZOOM:OUT:f")
}

record(fanout, "$(HOST):$(USER):ZOOM:OUT:f") {
	field($(UFAN), "$(HOST):$(USER):$(UUT):ZOOM:OUT PP")
}

record(bo, "$(HOST):$(USER):$(UUT):ZOOM:OUT") {
	field(FLNK, "$(HOST):$(USER):$(UUT):ZOOM:OUT:c PP")
}

record(calcout, "$(HOST):$(USER):$(UUT):ZOOM:OUT:c") {
	field(INPA, "$(HOST):$(USER):$(UUT):STRIDE")
	field(CALC, "A*2")
	field(OOPT, "Every Time")
	field(DOPT, "Use CALC")
	field(OUT,  "$(HOST):$(USER):$(UUT):STRIDE PP")
	field(FLNK, "$(HOST):$(USER):$(UUT):REFRESH PP")
}
